He cambiado todas las variables de nombre libro por book para no hacerme un lío y de paso he añadido el parámetro de la fecha, que se me había olvidado.
También he arreglado los models y controllers de forma definitiva (espero).
En todos los returns los mensajes los trato como json.